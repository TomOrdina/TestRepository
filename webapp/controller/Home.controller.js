sap.ui.define([
	"sap/ui/core/mvc/Controller",
	"sap/m/Dialog",
	"sap/m/MessageBox"
], function (Controller, Dialog, MessageBox) {
	"use strict";
	return Controller.extend("test.test.controller.Home", {
		
		setImage: function (imageVal) { //Take the running image from the video stream of camera
			var oVBox = this.getView().byId("wow");
			var Items = oVBox.getItems();
			var snapId = 'rk-' + Items.length;
			var textId = snapId + '-text';
			var oCanvas = new sap.ui.core.HTML({
				content: "<canvas id='" + snapId + "' width='320px' heght='320px'" + "style='2px solid red '></canvas>" + "<label id='" + textId +
					"'>" + this.attachName + "</label>"
			});
			oVBox.addItem(oCanvas);
			oCanvas.addEventDelegate({
				onAfterRendering: function () {
					var snapShotCanvas = document.getElementById(snapId);
					var oContext = snapShotCanvas.getContext('2d');
					var image = new sap.m.Image({});
					image.setSrc("data:image/jpeg;base64," + imageVal);
					oContext.drawImage(image, 0, 0, snapShotCanvas.width, snapShotCanvas.height);
				}
			});
		},
		onCapture: function () {
			var me = this;
			navigator.camera.getPicture(function (imageData) {
					me.setImage(imageData)
				}.bind(this),
				function (message) {
					MessageToast.show("An error occured!", {});
				}, {
					quality: 100,
					allowEdit: true,
					sourceType: navigator.camera.PictureSourceType.CAMERA,
					destinationType: navigator.camera.DestinationType.DATA_URL
				});
		},
		onInit: function () {
			var image= document.getElementById("testImage");
			var imagesrc = image.src;
			setImage(imagesrc);
		},
		// takePhoto: function() {
		// 		//This code was generated by the layout editor.
		// 	if(sap.ui.Device.browser.BROWSER.SAFARI==="sr" || sap.ui.Device.browser.BROWSER.CHROME==="cr" || sap.ui.Device.browser.BROWSER.FIREFOX==="ff"){	
		// 		var that = this;
		// 		//Step 1: Create a popup object as a global variable

		// 			this.fixedDialog = new Dialog({
		// 			title: "Click on Capture to take photo",

		// 			content: [
		// 				new sap.ui.core.HTML({
		// 					content: "<img id='player' src='https://images.pexels.com/photos/67636/rose-blue-flower-rose-blooms-67636.jpeg?auto=compress&cs=tinysrgb&dpr=1&w=500' />"
		// 				}),
		// 				new sap.m.Input({
		// 					placeholder: 'please enter image name here',
		// 					required: true
		// 				})
		// 			],
		// 			beginButton: new sap.m.Button({
		// 				text: "Capture Photo",
		// 				press: function(oEvent) {
		// 					// TO DO: get the object of our video player which live camera stream is running
		// 					//take the image object out of it and set to main page using global variable
		// 					var imageVal2 = document.getElementById("player");
		// 					navigator.camera.getPicture(getPhoto, onFail, { quality: 100 });
		// 					var oPopup = oEvent.getSource();
		// 					console.log(imageVal2.src);
		// 					that.attachName = oPopup.getParent().getContent()[1].getValue();
		// 					console.log(that.attachName);
		// 					that.fixedDialog.close();
		// 				}
		// 			}),
		// 			endButton: new sap.m.Button({
		// 				text: "Cancel",
		// 				press: function(oEvent) {
		// 					 var imageVal = document.getElementById("player");
		// 					 console.log(imageVal.src);
		// 					that.fixedDialog.close();
		// 					location.reload();
		// 				}
		// 			})
		// 		});
		// 		this.getView().addDependent(this.fixedDialog);
		// 		//Step 2: Launch the popup
		// 		this.fixedDialog.open();

		// 		this.fixedDialog.attachBeforeClose(this.setImage, this);
		// 		this.fixedDialog.close();

		// 		var handleSuccess = function(stream) {
		// 			player.srcObject = stream;
		// 		};

		// 		navigator.mediaDevices.getUserMedia({
		// 			video: true
		// 		}).then(handleSuccess);

		// 	}else{

		// 	}
		// 		MessageBox.show("Deze functie is niet ondersteund op uw gebruikte browser.")

		// 	}

	});
});